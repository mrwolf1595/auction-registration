# قواعد Firebase للسماح بالتسجيل العام (بدون تسجيل دخول)

## 🎯 الهدف
السماح للزوار بالتسجيل في المزادات **بدون الحاجة لتسجيل دخول**، مع الحفاظ على أمان باقي البيانات.

## 🔧 قواعد Firebase الجديدة

### للـ Realtime Database:
اذهب إلى [Firebase Console](https://console.firebase.google.com/) → Realtime Database → Rules

```json
{
  "rules": {
    "registrations": {
      ".read": "auth != null",
      ".write": true,
      "$registrationId": {
        ".validate": "newData.hasChildren(['bidderName', 'idNumber', 'phoneNumber', 'checkCount', 'issuingBank', 'cheques', 'registrationDate', 'status'])"
      }
    },
    "auctions": {
      ".read": true,
      ".write": "auth != null"
    }
  }
}
```

## 📋 شرح القواعد:

### 1. قسم `registrations`:
```json
"registrations": {
  ".read": "auth != null",     // ✅ القراءة: فقط للموظفين المسجلين
  ".write": true,              // ✅ الكتابة: مفتوح للجميع (للزوار)
  "$registrationId": {
    ".validate": "..."         // ✅ التحقق من صحة البيانات
  }
}
```

**لماذا؟**
- **`.write": true`** → يسمح لأي زائر بإنشاء تسجيل جديد
- **`.read": "auth != null"`** → فقط الموظفون يمكنهم قراءة التسجيلات
- **`.validate`** → يضمن أن البيانات المرسلة صحيحة ومكتملة

### 2. قسم `auctions`:
```json
"auctions": {
  ".read": true,               // ✅ القراءة: مفتوح للجميع
  ".write": "auth != null"     // ✅ الكتابة: فقط للموظفين
}
```

**لماذا؟**
- **`.read": true`** → يسمح للزوار بمشاهدة المزادات المتاحة
- **`.write": "auth != null"`** → فقط الموظفون يمكنهم إضافة/تعديل المزادات

## 🚀 خطوات التطبيق:

### الخطوة 1: تحديث قواعد Realtime Database
1. اذهب إلى [Firebase Console](https://console.firebase.google.com/)
2. اختر مشروع **Mazaad** (mazaad-66969)
3. اذهب إلى **Realtime Database** من القائمة الجانبية
4. انقر على تبويب **Rules**
5. انسخ القواعد أعلاه والصقها في المحرر
6. انقر على **Publish** (نشر)

### الخطوة 2: التحقق من عمل القواعد
1. افتح صفحة التسجيل: `http://localhost:3000/register`
2. املأ نموذج التسجيل
3. اضغط "إرسال النموذج"
4. ✅ يجب أن يعمل بدون أخطاء "Permission Denied"

## 🔒 الأمان:

### ما هو مؤمّن؟ ✅
- ✅ التسجيلات لا يمكن **قراءتها** إلا من الموظفين
- ✅ المزادات لا يمكن **تعديلها** إلا من الموظفين
- ✅ البيانات المرسلة تُتحقق من صحتها (validation)

### ما هو مفتوح؟ 🌐
- 🌐 الزوار يمكنهم **إنشاء** تسجيلات جديدة
- 🌐 الزوار يمكنهم **قراءة** قائمة المزادات المتاحة

### لماذا هذا آمن؟
1. **Validation Rules**: تمنع إرسال بيانات غير صحيحة
2. **Read Protection**: التسجيلات محمية من القراءة العامة
3. **Write Protection للمزادات**: فقط الموظفون يمكنهم إضافة مزادات

## 🎯 سيناريو الاستخدام:

### للزائر (العميل):
1. ✅ يفتح صفحة `/register`
2. ✅ يرى قائمة المزادات المتاحة (قراءة)
3. ✅ يملأ النموذج ويُرسل التسجيل (كتابة)
4. ✅ يحصل على رقم المضرب
5. ✅ يُنزّل الإقرار PDF

### للموظف:
1. ✅ يسجل دخول من `/employee/login`
2. ✅ يرى جميع التسجيلات في لوحة التحكم (قراءة)
3. ✅ يمكنه إنشاء/تعديل المزادات (كتابة)
4. ✅ يمكنه معالجة التسجيلات

## 🔴 قواعد بديلة (أكثر تشدداً):

إذا أردت منع التعديل على التسجيلات الموجودة:

```json
{
  "rules": {
    "registrations": {
      ".read": "auth != null",
      "$registrationId": {
        ".write": "!data.exists() || auth != null",
        ".validate": "newData.hasChildren(['bidderName', 'idNumber', 'phoneNumber', 'checkCount', 'issuingBank', 'cheques', 'registrationDate', 'status'])"
      }
    },
    "auctions": {
      ".read": true,
      ".write": "auth != null"
    }
  }
}
```

**الفرق:**
- `"!data.exists() || auth != null"` → يسمح بالإنشاء للجميع، لكن التعديل فقط للمسجلين

## ✅ النتيجة المتوقعة:

بعد تطبيق القواعد:
- ✅ الزوار يمكنهم التسجيل بدون أخطاء
- ✅ لا حاجة لتسجيل دخول للزوار
- ✅ الموظفون يحتفظون بصلاحياتهم الكاملة
- ✅ البيانات محمية من الوصول غير المصرح به

## 🚨 ملاحظات هامة:

1. ⚠️ **القواعد تطبق فوراً** بعد النشر
2. ⚠️ **اختبر القواعد** قبل الإطلاق الرسمي
3. ⚠️ **Validation مهم جداً** لمنع البيانات المزيفة
4. ⚠️ **لا تنسَ نشر القواعد** (زر Publish)

## 🧪 اختبار القواعد:

يمكنك اختبار القواعد مباشرة في Firebase Console:
1. اذهب إلى Rules tab
2. انقر على "Rules Playground"
3. جرب سيناريوهات مختلفة (authenticated/unauthenticated)
