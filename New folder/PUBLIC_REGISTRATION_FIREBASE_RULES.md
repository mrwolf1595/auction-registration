# ููุงุนุฏ Firebase ููุชุณุฌูู ุงูุนุงู
## ุฅุตูุงุญ ูุดููุฉ PERMISSION_DENIED

---

## ๐ด ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุงูุชุณุฌูู ูู ุตูุญุฉ `/register` (ุตูุญุฉ ุนุงูุฉ ุจุฏูู ุชุณุฌูู ุฏุฎูู)ุ ูุธูุฑ ุฎุทุฃ:
```
PERMISSION_DENIED: Permission denied
ูุดู ูู ุญูุธ ุงูุชุณุฌูู
```

## โ ุงูุญู

### 1. ููุงุนุฏ Firebase ุงูุตุญูุญุฉ

ูุฌุจ ุชุทุจูู ุงูููุงุนุฏ ุงูุชุงููุฉ ูู **Firebase Realtime Database Rules**:

```json
{
  "rules": {
    "registrations": {
      ".read": "auth != null",
      ".write": true,
      ".indexOn": ["auctionId", "status", "bidderNumber", "registrationDate"]
    },
    "auctions": {
      ".read": true,
      ".write": "auth != null",
      ".indexOn": ["date", "status"]
    },
    "authorizedUsersByEmail": {
      ".read": "auth != null",
      ".write": "auth != null"
    },
    "authorizedUsers": {
      ".read": "auth != null",
      ".write": "auth != null"
    }
  }
}
```

### 2. ุดุฑุญ ุงูููุงุนุฏ

#### **registrations**
- **`.read: "auth != null"`** - ุงููุฑุงุกุฉ ูุชุงุญุฉ ููุท ููููุธููู ุงููุตุงุฏููู
- **`.write: true`** - ุงููุชุงุจุฉ ูุชุงุญุฉ ููุฌููุน (ููุชุณุฌูู ุงูุนุงู)
- **`.indexOn`** - ููุฑุณุฉ ููุจุญุซ ุงูุณุฑูุน

#### **auctions**
- **`.read: true`** - ุงููุฑุงุกุฉ ูุชุงุญุฉ ููุฌููุน (ูุนุฑุถ ุงููุฒุงุฏุงุช ุงููุชุงุญุฉ)
- **`.write: "auth != null"`** - ุงููุชุงุจุฉ ูุชุงุญุฉ ููุท ููููุธููู

#### **authorizedUsersByEmail & authorizedUsers**
- **`.read/.write: "auth != null"`** - ููุงููุง ูุชุงุญ ููุท ููููุธููู ุงููุตุงุฏููู

---

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### ุงูุทุฑููุฉ 1: ูู Firebase Console (ุงูุฃุณุฑุน)

1. ุงุฐูุจ ุฅูู [Firebase Console](https://console.firebase.google.com/)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **Realtime Database**
4. ุงุถุบุท ุนูู ุชุจููุจ **Rules**
5. ุงูุตู ุงูููุงุนุฏ ุฃุนูุงู
6. ุงุถุบุท **Publish**

### ุงูุทุฑููุฉ 2: ุจุงุณุชุฎุฏุงู Firebase CLI

```bash
# ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
firebase login

# ูุดุฑ ุงูููุงุนุฏ
firebase deploy --only database
```

---

## ๐ ููุงุญุธุงุช ุงูุฃูุงู

### โ ูุง ุชู ุชุฃูููู:
- **ูุฑุงุกุฉ ุงูุชุณุฌููุงุช**: ูุชุงุญุฉ ููุท ููููุธููู ุงููุตุงุฏููู
- **ุฅุฏุงุฑุฉ ุงููุฒุงุฏุงุช**: ูุชุงุญุฉ ููุท ููููุธููู
- **ุงููุณุชุฎุฏููู ุงููุตุฑุญ ููู**: ูุญููุฉ ุจุงููุงูู

### โ๏ธ ููุงุท ูููุฉ:
- ุงูุณูุงุญ ุจุงููุชุงุจุฉ ุงูุนุงูุฉ ูู `registrations` ุขูู ูุฃู:
  - ูุง ูููู ูููุณุชุฎุฏููู ูุฑุงุกุฉ ุชุณุฌููุงุช ุงูุขุฎุฑูู
  - ูุชู ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูู ุงูุชุทุจูู
  - ูุชู ูุฑุงุฌุนุฉ ุงูุชุณุฌููุงุช ูู ูุจู ุงูููุธููู

### ๐ก๏ธ ุชุญุณููุงุช ุฃูุงู ูุณุชูุจููุฉ (ุงุฎุชูุงุฑูุฉ):

ุฅุฐุง ุฃุฑุฏุช ุชุฃููู ุฃูุซุฑุ ููููู ุงุณุชุฎุฏุงู ููุงุนุฏ ูุชูุฏูุฉ:

```json
{
  "rules": {
    "registrations": {
      ".read": "auth != null",
      "$registrationId": {
        ".write": "!data.exists() && newData.exists()",
        ".validate": "newData.hasChildren(['bidderName', 'idNumber', 'phoneNumber', 'checkCount', 'issuingBank', 'cheques', 'registrationDate', 'status', 'auctionId'])"
      },
      ".indexOn": ["auctionId", "status", "bidderNumber", "registrationDate"]
    }
  }
}
```

ูุฐู ุงูููุงุนุฏ ุงููุชูุฏูุฉ:
- ุชุณูุญ ููุท ุจุฅูุดุงุก ุชุณุฌููุงุช ุฌุฏูุฏุฉ (ูุง ูููู ุงูุชุนุฏูู ุฃู ุงูุญุฐู)
- ุชุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุญููู ุงููุทููุจุฉ

---

## ๐งช ุงุฎุชุจุงุฑ ุงูููุงุนุฏ

ุจุนุฏ ุชุทุจูู ุงูููุงุนุฏุ ููููู ุงุฎุชุจุงุฑูุง:

### 1. ุงุฎุชุจุงุฑ ุงูุชุณุฌูู ุงูุนุงู
- ุงูุชุญ ุตูุญุฉ `/register`
- ุงููุฃ ุงููููุฐุฌ
- ุงุถุบุท "ุชุณุฌูู ุงููุดุงุฑูุฉ"
- ูุฌุจ ุฃู ูุชู ุงูุญูุธ ุจูุฌุงุญ โ

### 2. ุงุฎุชุจุงุฑ ุงููุฑุงุกุฉ (ุจุฏูู ุชุณุฌูู ุฏุฎูู)
- ุญุงูู ุงููุตูู ูุตูุญุฉ `/employee/dashboard` ุจุฏูู ุชุณุฌูู ุฏุฎูู
- ูุฌุจ ุฃู ูุง ุชุธูุฑ ุฃู ุชุณุฌููุงุช (ูุญููุฉ) โ

### 3. ุงุฎุชุจุงุฑ ุงููุฑุงุกุฉ (ูุน ุชุณุฌูู ุฏุฎูู)
- ุณุฌู ุฏุฎูู ูููุธู
- ุงูุชุญ `/employee/dashboard`
- ูุฌุจ ุฃู ุชุธูุฑ ุฌููุน ุงูุชุณุฌููุงุช โ

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูุง ุฒุงูุช ุงููุดููุฉ ููุฌูุฏุฉ:

1. **ุชุฃูุฏ ูู ูุดุฑ ุงูููุงุนุฏ ุจุดูู ุตุญูุญ**
   ```bash
   firebase deploy --only database
   ```

2. **ุงูุณุญ ุงููุงุด**
   - ูู ุงููุชุตูุญุ ุงุถุบุท `Ctrl + Shift + R`
   - ุฃู ุงูุณุญ ุงููุงุด ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ

3. **ุชุญูู ูู ุงูููุงุนุฏ ูู Firebase Console**
   - ุงุฐูุจ ุฅูู Realtime Database โ Rules
   - ุชุฃูุฏ ูู ุฃู ุงูููุงุนุฏ ุงูููุดูุฑุฉ ูู ุงูุตุญูุญุฉ

4. **ุชุญูู ูู Firebase Config**
   - ุชุฃูุฏ ูู ุฃู ููู `.env.local` ูุญุชูู ุนูู ุงูููุงุชูุญ ุงูุตุญูุญุฉ
   - ุชุฃูุฏ ูู ุฃู Firebase ุชู ุชููุฆุชู ุจุดูู ุตุญูุญ ูู `src/lib/firebase.ts`

---

## ๐ ููู ุงูููุงุนุฏ

ุงูููุงุนุฏ ูุญููุธุฉ ูู ุงูููู: `firebase-rules-fix.json`

ููููู ูุณุฎูุง ููุตููุง ูุจุงุดุฑุฉ ูู Firebase Console.

---

## โจ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐู ุงูููุงุนุฏ:

โ **ุตูุญุฉ ุงูุชุณุฌูู ุงูุนุงูุฉ** (`/register`):
- ุชุนูู ุจุฏูู ุชุณุฌูู ุฏุฎูู
- ูููู ูุฃู ุดุฎุต ุงูุชุณุฌูู ูู ุงููุฒุงุฏ
- ูุชู ุญูุธ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

โ **ุตูุญุฉ ุงูููุธููู** (`/employee/dashboard`):
- ูุญููุฉ ุจุชุณุฌูู ุฏุฎูู
- ุชุนุฑุถ ุฌููุน ุงูุชุณุฌููุงุช ููููุธููู ุงููุตุงุฏููู ููุท

โ **ุงูุฃูุงู**:
- ูุง ูููู ูููุณุชุฎุฏููู ุงูุนุงุฏููู ูุฑุงุกุฉ ุงูุชุณุฌููุงุช
- ููุท ุงูููุธููู ูููููู ุฅุฏุงุฑุฉ ุงููุฒุงุฏุงุช ูุงููุณุชุฎุฏููู

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุงููุดููุฉ ูุงูุช ูู ููุงุนุฏ Firebase ุงูุชู ุชุชุทูุจ ุงููุตุงุฏูุฉ ูููุชุงุจุฉุ ููู ุตูุญุฉ ุงูุชุณุฌูู ุงูุนุงูุฉ ูุง ุชุชุทูุจ ูุตุงุฏูุฉ. ุงูุญู ูู ุงูุณูุงุญ ุจุงููุชุงุจุฉ ุงูุนุงูุฉ ูู `registrations` ูุน ุญูุงูุฉ ุงููุฑุงุกุฉ ููููุธููู ููุท.

**ุงูููุงุนุฏ ุงููุทููุจุฉ:**
- `registrations`: `.write: true` (ูุชุงุจุฉ ููุฌููุน)
- `registrations`: `.read: "auth != null"` (ูุฑุงุกุฉ ููููุธููู ููุท)
- `auctions`: `.read: true` (ูุฑุงุกุฉ ููุฌููุน ูุนุฑุถ ุงููุฒุงุฏุงุช)
- ุจุงูู ุงูุฌุฏุงูู ูุญููุฉ ุจุงููุงูู

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 14 ุฃูุชูุจุฑ 2025  
**ุขุฎุฑ ุชุญุฏูุซ:** 14 ุฃูุชูุจุฑ 2025
