# ๐ ูุธุงู ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ุงููุญุณู - Session Management System

## ูุธุฑุฉ ุนุงูุฉ (Overview)

ุชู ุชุทุจูู ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ูููุฑ:
- โ ุงูุชูุงุก ุงูุฌูุณุฉ ุงูุชููุงุฆู ุจุนุฏ 30 ุฏูููุฉ ูู ุนุฏู ุงููุดุงุท
- โ ุชุชุจุน ูุดุงุท ุงููุณุชุฎุฏู (ุญุฑูุฉ ุงููุงูุณุ ุงููุชุงุจุฉุ ุงูููุฑุ ุฅูุฎ)
- โ ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู ุนูุฏ ุงูุชูุงุก ุงูุฌูุณุฉ
- โ ุชูุจูู ุงุฎุชูุงุฑู ูุจู ุงูุชูุงุก ุงูุฌูุณุฉ ุจุฏูููุชูู
- โ ุฅุนุฏุงุฏุงุช Firebase ูุถูุงู ุนุฏู ุจูุงุก ุงูุฌูุณุฉ ุจุนุฏ ุฅุบูุงู ุงููุชุตูุญ
- โ ูุณุญ ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท (cookies) ู JWT ุชููุงุฆูุงู

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ (Technical Architecture)

### 1. **ูุฏูุฑ ุงูุฌูุณุงุช (Session Manager)** - `src/lib/sessionManager.ts`

ูููุฑ ูุฐุง ุงูููู ูุฆุฉ `SessionManager` ุงูุชู ุชุฑุงูุจ ูุดุงุท ุงููุณุชุฎุฏู ูุชุฏูุฑ ุงูุชูุงุก ุงูุฌูุณุฉ.

#### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:
- **ุชุชุจุน ุงููุดุงุท**: ูุฑุงูุจ ุฃุญุฏุงุซ ุงููุงูุณุ ููุญุฉ ุงูููุงุชูุญุ ูุงูุชูุฑูุฑ
- **ูุคูุช ุนุฏู ุงููุดุงุท**: 30 ุฏูููุฉ (ูุงุจู ููุชุฎุตูุต)
- **ูุญุต ุฏูุฑู**: ููุญุต ุญุงูุฉ ุงูุฌูุณุฉ ูู ุฏูููุฉ
- **ุชุฎุฒูู ูุญูู**: ูุญูุธ ููุช ุขุฎุฑ ูุดุงุท ูู localStorage
- **ุชูุธูู ุชููุงุฆู**: ูุฒูู ุงููุณุชูุนูู ูุงููุคูุชุงุช ุนูุฏ ุฅููุงู ุงููุฑุงูุจุฉ

#### ุงูุฃุญุฏุงุซ ุงููุฑุงูุจุฉ:
```javascript
const ACTIVITY_EVENTS = [
  'mousedown',   // ููุฑ ุงููุงูุณ
  'mousemove',   // ุญุฑูุฉ ุงููุงูุณ
  'keypress',    // ุถุบุท ุงูููุงุชูุญ
  'scroll',      // ุงูุชูุฑูุฑ
  'touchstart',  // ุงูููุณ (ููุฃุฌูุฒุฉ ุงูููุญูุฉ)
  'click',       // ุงูููุฑ
  'keydown',     // ุงูุถุบุท ุนูู ุงูููุชุงุญ
];
```

#### ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ:
```javascript
const INACTIVITY_TIMEOUT = 30 * 60 * 1000; // 30 ุฏูููุฉ
const WARNING_TIME = 2 * 60 * 1000;         // ุชูุจูู ูุจู ุฏูููุชูู
const CHECK_INTERVAL = 60 * 1000;            // ูุญุต ูู ุฏูููุฉ
```

---

### 2. **ุฅุนุฏุงุฏุงุช Firebase** - `src/lib/firebase.ts`

ุชู ุชูููู Firebase Auth ูุงุณุชุฎุฏุงู `browserSessionPersistence`:

```typescript
import { setPersistence, browserSessionPersistence } from 'firebase/auth';

// ุชูููู ุงุณุชูุฑุงุฑ ุงูุฌูุณุฉ ูููุชุตูุญ ููุท
setPersistence(auth, browserSessionPersistence)
```

#### ูุง ูุนููู ูุฐุง:
- โ ุงูุฌูุณุฉ ุชุจูู ููุท ุฎูุงู ุฌูุณุฉ ุงููุชุตูุญ ุงูุญุงููุฉ
- โ ูุชู ูุณุญ ุงููุตุงุฏูุฉ ุชููุงุฆูุงู ุนูุฏ ุฅุบูุงู ุงููุชุตูุญ/ุงูุชุจููุจ
- โ ูู ูุจูู ุงููุณุชุฎุฏู ูุณุฌูุงู ุงูุฏุฎูู ููุฏุฉ 14 ูููุงู
- โ ูุง ูุชู ุชุฎุฒูู JWT ูู localStorage ุจุดูู ุฏุงุฆู

---

### 3. **ุฎุทุงู React** - `src/hooks/useSessionManager.ts`

ูููุฑ ูุงุฌูุฉ ุณููุฉ ูุฏูุฌ ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ูู ููููุงุช React.

#### ุงุณุชุฎุฏุงู ุฃุณุงุณู:
```typescript
const sessionStatus = useSessionManager(isAuthenticated, {
  showWarning: true,          // ุฅุธูุงุฑ ุชูุจูู ูุจู ุงูุงูุชูุงุก
  onWarning: () => {
    // ูุนุงูุฌ ูุฎุตุต ููุชูุจูู
    console.warn('Session expiring soon!');
  },
  onLogout: () => {
    // ูุนุงูุฌ ูุฎุตุต ูุจู ุชุณุฌูู ุงูุฎุฑูุฌ
    console.log('Logging out...');
  },
  redirectPath: '/employee/login',
  enabled: true,              // ุชูููู/ุชุนุทูู ุงููุธุงู
});
```

#### ุงูุฎุตุงุฆุต ุงููุชุงุญุฉ:
```typescript
interface SessionStatus {
  isActive: boolean;           // ูู ุงููุฑุงูุจุฉ ูุดุทุฉ
  remainingMinutes: number;    // ุงูููุช ุงููุชุจูู ุจุงูุฏูุงุฆู
  showingWarning: boolean;     // ูู ูุชู ุนุฑุถ ุชูุจูู
  resetTimer: () => void;      // ุฅุนุงุฏุฉ ุชุนููู ุงููุคูุช ูุฏููุงู
}
```

---

### 4. **ุชุญุฏูุซุงุช ุงููุตุงุฏูุฉ** - `src/lib/auth.ts`

ุชู ุฏูุฌ ูุฏูุฑ ุงูุฌูุณุงุช ูุน ูุธุงุฆู ุงููุตุงุฏูุฉ:

```typescript
// ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
export const signOutEmployee = async (): Promise<void> => {
  // ุฅููุงู ูุฑุงูุจุฉ ุงูุฌูุณุฉ
  sessionManager.stopMonitoring();
  
  // ุชุณุฌูู ุงูุฎุฑูุฌ ูู Firebase
  await signOut(auth);
};
```

---

## ๐ ุฏููู ุงูุงุณุชุฎุฏุงู (Usage Guide)

### ูู ุตูุญุฉ ููุญุฉ ุงูุชุญูู (Dashboard):

```typescript
import { useSessionManager } from '@/hooks/useSessionManager';

export default function DashboardPage() {
  const [employee, setEmployee] = useState<EmployeeUser | null>(null);
  
  // ุชูุนูู ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
  const sessionStatus = useSessionManager(!!employee, {
    showWarning: true,
    onWarning: () => {
      // ุฅุธูุงุฑ ุฅุดุนุงุฑ ูููุณุชุฎุฏู
      toast.warning('ุงูุฌูุณุฉ ุณุชูุชูู ุฎูุงู ุฏูููุชูู!');
    },
    onLogout: () => {
      // ุชูุธูู ุงูุจูุงูุงุช ุงููุญููุฉ
      localStorage.clear();
    },
    redirectPath: '/employee/login',
  });

  return (
    <div>
      {/* ุนุฑุถ ุญุงูุฉ ุงูุฌูุณุฉ */}
      {sessionStatus.isActive && (
        <div>
          <p>ุงูุฌูุณุฉ ูุดุทุฉ</p>
          <p>ุงูููุช ุงููุชุจูู: {sessionStatus.remainingMinutes} ุฏูููุฉ</p>
        </div>
      )}
    </div>
  );
}
```

### ูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู (Login):

ุชู ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฑุณุงูุฉ ุงูุชูุงุก ุงููููุฉ:

```typescript
const searchParams = useSearchParams();

useEffect(() => {
  // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฎุฑูุฌ ุจุณุจุจ ุงูุชูุงุก ุงููููุฉ
  const timeout = searchParams.get('timeout');
  if (timeout === 'true') {
    setTimeoutMessage('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุชููุงุฆูุงู ุจุณุจุจ ุนุฏู ุงููุดุงุท ููุฏุฉ 30 ุฏูููุฉ');
  }
}, [searchParams]);
```

---

## ๐ฏ ุณูุฑ ุงูุนูู (Workflow)

### 1. ุชุณุฌูู ุงูุฏุฎูู:
```
ุงููุณุชุฎุฏู โ ุชุณุฌูู ุงูุฏุฎูู โ Firebase Auth โ ุชุนููู ุงูุฌูุณุฉ
                                    โ
                          ุจุฏุก ูุฑุงูุจุฉ ุงูุฌูุณุฉ (30 ุฏูููุฉ)
```

### 2. ุงููุดุงุท:
```
ูุดุงุท ุงููุณุชุฎุฏู โ ุชุญุฏูุซ ููุช ุขุฎุฑ ูุดุงุท โ ุญูุธ ูู localStorage
                                    โ
                             ุฅุนุงุฏุฉ ุชุนููู ุงููุคูุช (30 ุฏูููุฉ)
```

### 3. ุนุฏู ุงููุดุงุท:
```
28 ุฏูููุฉ ุนุฏู ูุดุงุท โ ุชูุจูู ุงุฎุชูุงุฑู (ุฏูููุชุงู ูุชุจููุชุงู)
         โ
30 ุฏูููุฉ ุนุฏู ูุดุงุท โ ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู
         โ
ุฅุนุงุฏุฉ ุงูุชูุฌูู ุฅูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู (ูุน ุฑุณุงูุฉ timeout)
```

### 4. ุฅุบูุงู ุงููุชุตูุญ:
```
ุฅุบูุงู ุงููุชุตูุญ/ุงูุชุจููุจ โ Firebase ููุณุญ ุงูุฌูุณุฉ ุชููุงุฆูุงู
                          โ
                   ูุง ููุฌุฏ JWT ูุญููุธ
                          โ
               ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
```

---

## ๐ง ุงูุชุฎุตูุต (Customization)

### ุชุบููุฑ ูุฏุฉ ุงูุชูุงุก ุงููููุฉ:

ูู `src/lib/sessionManager.ts`:
```typescript
// ุชุบููุฑ ูู 30 ุฏูููุฉ ุฅูู 15 ุฏูููุฉ
const INACTIVITY_TIMEOUT = 15 * 60 * 1000;
```

### ุชุนุทูู ุงูุชูุจูู:

```typescript
useSessionManager(isAuthenticated, {
  showWarning: false,  // ูุง ุชูุจูู
});
```

### ุชุฎุตูุต ูุณุงุฑ ุฅุนุงุฏุฉ ุงูุชูุฌูู:

```typescript
useSessionManager(isAuthenticated, {
  redirectPath: '/custom/login',
});
```

### ุฅุถุงูุฉ ุฃุญุฏุงุซ ูุฑุงูุจุฉ ุฅุถุงููุฉ:

ูู `src/lib/sessionManager.ts`:
```typescript
const ACTIVITY_EVENTS = [
  ...existingEvents,
  'wheel',        // ุนุฌูุฉ ุงููุงูุณ
  'resize',       // ุชุบููุฑ ุญุฌู ุงููุงูุฐุฉ
  'focus',        // ุงูุชุฑููุฒ ุนูู ุงููุงูุฐุฉ
];
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ (Testing)

### ุงุฎุชุจุงุฑ ุงูุชูุงุก ุงูุฌูุณุฉ:

1. **ุชูููู ุงููุฏุฉ ูุคูุชุงู**:
```typescript
// ููุงุฎุชุจุงุฑ ููุท - 2 ุฏูููุฉ ุจุฏูุงู ูู 30
const INACTIVITY_TIMEOUT = 2 * 60 * 1000;
```

2. **ุชุณุฌูู ุงูุฏุฎูู** ุฅูู ููุญุฉ ุงูุชุญูู
3. **ุนุฏู ุงูููุงู ุจุฃู ูุดุงุท** ููุฏุฉ 2 ุฏูููุฉ
4. **ุงูุชุญูู** ูู ุชุณุฌูู ุงูุฎุฑูุฌ ุงูุชููุงุฆู

### ุงุฎุชุจุงุฑ ุงูุชูุจูู:

1. ุชูุนูู `showWarning: true`
2. ุงูุงูุชุธุงุฑ ุญุชู ุชุจูู ุฏูููุชุงู
3. ุงูุชุญูู ูู ุนุฑุถ ุงูุชูุจูู

### ุงุฎุชุจุงุฑ ุฅุนุงุฏุฉ ุชุนููู ุงููุคูุช:

1. ุชุณุฌูู ุงูุฏุฎูู
2. ุงูุงูุชุธุงุฑ 25 ุฏูููุฉ
3. ุชุญุฑูู ุงููุงูุณ (ูุดุงุท)
4. ุงูุชุญูู ูู ุฅุนุงุฏุฉ ุชุนููู ุงููุคูุช ุฅูู 30 ุฏูููุฉ

---

## ๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก (Performance)

- โ **ุชุฃุซูุฑ ููุฎูุถ ุนูู ุงูุฃุฏุงุก**: ูุญุต ูู ุฏูููุฉ ููุท
- โ **ูุณุชูุนุงุช ุณูุจูุฉ**: `{ passive: true }` ูุนุฏู ุญุธุฑ ุงูุชูุฑูุฑ
- โ **ุชูุธูู ุชููุงุฆู**: ุฅุฒุงูุฉ ุงููุณุชูุนุงุช ุนูุฏ ุฅูุบุงุก ุชุซุจูุช ุงููููู
- โ **ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ ุงูุฃูุซู**: ูุซูู ูุงุญุฏ ููุท (singleton)

---

## ๐ ุงูุฃูุงู (Security)

### ูุง ุชู ุชุญูููู:

โ **ูุง ุฌูุณุงุช ุทูููุฉ ุงูุฃูุฏ**: 30 ุฏูููุฉ ูุญุฏ ุฃูุตู ุจุฏูู ูุดุงุท
โ **ูุณุญ ุชููุงุฆู**: JWT ู cookies ุชููุณุญ ุชููุงุฆูุงู
โ **ุนุฏู ุงุณุชูุฑุงุฑ ุงูุฌูุณุฉ**: ูุง ุชุฎุฒูู ุฏุงุฆู ูู localStorage
โ **ุฌูุณุฉ ุงููุชุตูุญ ููุท**: ุชูุชูู ุนูุฏ ุฅุบูุงู ุงููุชุตูุญ
โ **ุญูุงูุฉ ูู ุงุฎุชุทุงู ุงูุฌูุณุฉ**: ุงูุชูุงุก ุชููุงุฆู ุจุนุฏ ุนุฏู ุงููุดุงุท

### ุฃูุถู ุงูููุงุฑุณุงุช ุงููุทุจูุฉ:

1. **Principle of Least Privilege**: ุฌูุณุงุช ูุตูุฑุฉ ุงูุฃูุฏ
2. **Defense in Depth**: ุทุจูุงุช ูุชุนุฏุฏุฉ ูู ุงูุญูุงูุฉ
3. **Secure by Default**: ุงูุฅุนุฏุงุฏุงุช ุงูุขููุฉ ุงูุชุฑุงุถูุงู
4. **Zero Trust**: ุงูุชุญูู ุงููุณุชูุฑ ูู ุงูุฌูุณุฉ

---

## ๐ ุงูุตูุงูุฉ ูุงูุชุทููุฑ ุงููุณุชูุจูู

### ุฅููุงููุงุช ุงูุชุญุณูู:

1. **ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช**: ูุธุงู toast ููุชูุจููุงุช
2. **ุชุฎุฒูู ุงูุณุญุงุจุฉ**: ุญูุธ ุญุงูุฉ ุงูุฌูุณุฉ ูู Firestore
3. **ุชุญูููุงุช**: ุชุชุจุน ุฃููุงุท ุงุณุชุฎุฏุงู ุงูุฌูุณุงุช
4. **ุฌูุณุงุช ูุชุนุฏุฏุฉ ุงูุฃุฌูุฒุฉ**: ูุฒุงููุฉ ุนุจุฑ ุงูุฃุฌูุฒุฉ
5. **ุชูุฏูุฏ ุชููุงุฆู**: ุฎูุงุฑ ูุชูุฏูุฏ ุงูุฌูุณุฉ ุชููุงุฆูุงู ุนูุฏ ุงููุดุงุท

### ููุงุท ุงููุฑุงูุจุฉ:

- ๐ ูุชูุณุท ูุฏุฉ ุงูุฌูุณุงุช
- ๐ ูุนุฏู ุงูุชูุงุก ุงููููุงุช
- ๐ ุฃููุงุช ุฐุฑูุฉ ุงูุงุณุชุฎุฏุงู
- ๐ ูุนุฏู ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู

---

## ๐ ุงููุฑุงุฌุน ูุงูููุงุฑุฏ

### ูุซุงุฆู Firebase:
- [Firebase Auth Session Management](https://firebase.google.com/docs/auth/web/auth-state-persistence)
- [Firebase Security Best Practices](https://firebase.google.com/docs/rules/basics)

### ูุนุงููุฑ ุงูุฃูุงู:
- [OWASP Session Management](https://owasp.org/www-community/controls/Session_Management)
- [NIST Authentication Guidelines](https://pages.nist.gov/800-63-3/)

---

## โ ุงูุฎูุงุตุฉ (Summary)

ุชู ุชูููุฐ ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ูููุฑ:

1. โ **ุงูุชูุงุก ุชููุงุฆู ุจุนุฏ 30 ุฏูููุฉ ูู ุนุฏู ุงููุดุงุท**
2. โ **ุชุชุจุน ูุดุงุท ุงููุณุชุฎุฏู ุจุดูู ุดุงูู**
3. โ **ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู ูุฅุนุงุฏุฉ ุชูุฌูู**
4. โ **ุฅุนุฏุงุฏุงุช Firebase ุงูุขููุฉ (browserSessionPersistence)**
5. โ **ุนุฏู ุจูุงุก JWT ุฃู cookies ุจุนุฏ ุฅุบูุงู ุงููุชุตูุญ**
6. โ **ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู ูุน React Hooks**
7. โ **ูุคุดุฑุงุช ุจุตุฑูุฉ ูุญุงูุฉ ุงูุฌูุณุฉ**
8. โ **ุฑุณุงุฆู ูุงุถุญุฉ ุนูุฏ ุงูุชูุงุก ุงููููุฉ**

ุงููุธุงู ุฌุงูุฒ ููุฅูุชุงุฌ ููููุฑ ุฃูุงูุงู ูุญุณูุงู ุถุฏ:
- ุงุฎุชุทุงู ุงูุฌูุณุฉ (Session Hijacking)
- ุงููุตูู ุบูุฑ ุงููุตุฑุญ (Unauthorized Access)
- ุงูุฌูุณุงุช ุงูููุฌูุฑุฉ (Abandoned Sessions)

---

## ๐ ุชูุงูููุง!

ููุฏ ุชู ุชุทุจูู ูุธุงู ุฅุฏุงุฑุฉ ุฌูุณุงุช ุขูู ููุนุงู! ๐

ูููุฒูุฏ ูู ุงููุนูููุงุช ุฃู ุงูุฏุนูุ ุฑุงุฌุน ุงููููุงุช:
- `src/lib/sessionManager.ts`
- `src/hooks/useSessionManager.ts`
- `src/lib/firebase.ts`
- `src/lib/auth.ts`
